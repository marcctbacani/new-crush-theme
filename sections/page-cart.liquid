<div data-section-id="{{ section.id }}" data-section-type="page-cart">

  {%- assign shippingCalculatorDefaultCountry = section.settings.shipping_calculator_default_country | escape -%}

  {% if cart.item_count > 0 %}
    <form action="/cart" method="post">
      <table class="cart-items clean {% if settings.enable_currency_switcher %}no-ajax{% endif %}">
        <thead>
          <tr>
            <th class="first">{{ 'general.general.product' | t }}</th>
            <th>{{ 'general.general.price' | t }}</th>
            <th>{{ 'general.general.quantity' | t }}</th>
            <th class="last">{{ 'general.general.total' | t }}</th>
          </tr>
        </thead>

        <tbody>
          {% for item in cart.items %}
            <tr class="cart-item variant-{{ item.variant.id }}" data-variant="{{ item.variant.id }}" data-title="{{ item.product.title }}" data-url="{{ item.product.url }}">
              <td class="cart-item-product first">
                <a class="cart-item-image" href="{{ item.product.url }}">
                  {%
                    include 'rimg',
                    img: item.image,
                    size: 'medium',
                    lazy: true
                  %}
                </a>

                <span class="cart-item-vendor vendor">
                  <a href="{{ shop.url  }}/collections/vendors?q={{ item.vendor  }}">
                    {{ item.vendor }}
                  </a>
                </span>

                <span class="cart-item-title">
                  {{ item.product.title | link_to: item.product.url }}
                </span>

                {% for option in item.variant.options %}
                  {% unless option == 'Default Title' %}
                    <span class="cart-item-option">{{ option }}</span>
                  {% endunless %}
                {% endfor %}

                {% if item.properties %}
                  <div class="cart-line-item-properties">
                    {% for property in item.properties %}
                      {% if property.last != blank %}
                        <span class="cart-item-property">
                          <strong>{{ property.first }}</strong>:

                          {% if property.last contains "/uploads/" %}
                            <span class="cart-item-property-value cart-item-upload" data-file="{{ property.last }}">
                              {{ property.last | split: '/' | last }}
                            </span>
                          {% else %}
                            <span class="cart-item-property-value">
                              {{ property.last }}
                            </span>
                          {% endif %}
                        </span>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endif %}

                {% if settings.enable_currency_switcher %}
                  <a class="cart-item-remove" href="/cart/change?line={{ forloop.index }}&amp;quantity=0">&#57360;</a>
                {% endif %}
              </td>
              <td class="cart-item-price"><span class="money">{{ item.price | money }}</span></td>
              <td class="cart-item-quantity">
                <input class="cart-item-quantity-display" type="text" name="updates[]" value="{{ item.quantity }}" size="1">
                <span class="cart-item-decrease">&#57365;</span><span class="cart-item-increase">&#57366;</span>
              </td>
              <td class="cart-item-total last"><span class="money">{{ item.quantity | times: item.price | money }}</span></td>
            </tr>
          {% endfor %}
        </tbody>
      </table>

      {% if section.settings.cart_special_instructions or section.settings.cart_shipping_calculator %}
        <div class="cart-tools">
          {% if section.settings.cart_special_instructions %}
            <div class="cart-instructions">
              <p>{{ 'cart.special_instructions' | t }}</p>
              <textarea name="note" rows="4">{{ cart.note }}</textarea>
            </div>
          {% endif %}

          {% if section.settings.cart_shipping_calculator and cart.requires_shipping %}
            {% include 'shipping-calculator' %}
          {% endif %}
        </div>
      {% endif %}

      <div class="cart-checkout">
        <p class="cart-price"><span class="money">{{ cart.total_price | money }}</span></p>
        <p class="cart-message"><em>{{ 'cart.tax_and_shipping' | t }}</em></p>
        {% if settings.enable_currency_switcher %}
          <input type="submit" name="checkout" value="{{ 'cart.submit' | t }}">
        {% else %}
          <a class="cart-checkout-button button" href="/checkout">{{ 'cart.submit' | t }}</a>
        {% endif %}

        {% if additional_checkout_buttons %}
          <div class="cart-additional-buttons">
            {{ content_for_additional_checkout_buttons }}
          </div>
        {% endif %}
      </div>
    </form>
  {% else %}
    <p class="cart-empty-message">{{ 'cart.empty' | t }}</p>
  {% endif %}

  {%- capture cartText -%}
    {{- 'layout.header.cart_item_count.one' | t | append: '|' }}{{ 'layout.header.cart_item_count.other' | t -}}
  {%- endcapture -%}

  <script>
    window.sectionJSON = {{ section.settings | json }};
    window.cartTextJSON = {{ cartText | split: '|' | json }};
  </script>

</div>

{% schema %}
{
  "name": "Cart page",
  "class": "section-cart",
  "settings": [
    {
      "type": "checkbox",
      "id": "cart_special_instructions",
      "label": "Enable order notes",
      "default": true
    },
    {
      "type": "header",
      "content": "Shipping rate calculator"
    },
    {
      "type": "checkbox",
      "id": "cart_shipping_calculator",
      "label": "Enable",
      "default": true
    },
    {
      "type": "text",
      "id": "shipping_calculator_default_country",
      "label": "Default country",
      "info": "If a customer is logged in, their default shipping address country will be selected.",
      "default": "United States"
    }
  ]
}

{% endschema %}